<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>ROA Colors.gml generator</title>
		<link rel="stylesheet" href="index.css">
		<script src="vue.js"></script>
	</head>
	<body>

		<!-- Heavily based on https://vuejsexamples.com/vue-color-picker/ - "a cool Color Picker with vue.js BY Florian Schulz." -->
		<template id="color-picker-template">
			<div class="color-picker">
				<div class="color-picker__overlay" v-if="isVisible" v-on:click="hide"></div>
				<transition name="pop">
					<div class="color-picker__flyout" v-if="isVisible">
						<div class="color-chip" v-bind:style="{'background': color}">
							<div class="color-chip__inner">
								RGB:
								<input class="color-input" size="3" v-bind:value="r" @input="validateAndSendRgbColorUpdate($event, 'r')" v-bind:disabled="readonly"></input>
								<input class="color-input" size="3" v-bind:value="g" @input="validateAndSendRgbColorUpdate($event, 'g')" v-bind:disabled="readonly"></input>
								<input class="color-input" size="3" v-bind:value="b" @input="validateAndSendRgbColorUpdate($event, 'b')" v-bind:disabled="readonly"></input>

								<hr>

								HSV:
								<input class="color-input" placeholder="H (todo)" size="3" v-bind:disabled="readonly"></input>
								<input class="color-input" placeholder="S (todo)" size="3" v-bind:disabled="readonly"></input>
								<input class="color-input" placeholder="V (todo)" size="3" v-bind:disabled="readonly"></input>

								<hr>

								HSL:
								<input class="color-input" placeholder="H (todo)" size="3" v-bind:disabled="readonly"></input>
								<input class="color-input" placeholder="S (todo)" size="3" v-bind:disabled="readonly"></input>
								<input class="color-input" placeholder="L (todo)" size="3" v-bind:disabled="readonly"></input>

								<hr>

								HEX: <input class="color-input" placeholder="hex (todo)" @input="validateAndUpdateHex" v-bind:disabled="readonly"></input>
								<br><br>
								<span style="cursor:pointer;"@click="hide(); $emit('delete-color')">üóëÔ∏è</span>
							</div>
						</div>
					</div>
				</transition>
				<div class="swatch" v-bind:style="{'background': color}" v-on:click="toggle"></div>
			</div>
		</template>

		<div id="app">
			<textarea id="gmlDisplay" @input="parseInputGml"></textarea>

			<div id="flexContainerRight">
				<div class="darkerbg">
					<div>
						<input type="file" id="file" @change="loadFilePreview"></input>
						<input type="number" name="zoom" min="1" style="width: 40px" v-model:value="zoomFactor" @input="zoomFactor=Math.max(1, parseInt(zoomFactor))"></input>
					</div>
					<canvas id="preview" @click="previewClick" class="darkerbg"></canvas>
					<div>
						<color-picker style="display:inline-block"
							v-bind:r = "pickedColor.r"
							v-bind:g = "pickedColor.g"
							v-bind:b = "pickedColor.b"
							readonly="true"
						></color-picker>
						rgb({{pickedColor.r}}, {{pickedColor.g}}, {{pickedColor.b}}) (x: {{pickedColor.x}}, y: {{pickedColor.y}})
					</div>
					<table>
						<tr>
							<td>colors not in palette:</td>
							<td v-for="color in colorsNotInPalette">
								<color-picker
									v-bind:r = "color.r"
									v-bind:g = "color.g"
									v-bind:b = "color.b"
									readonly="true"
								></color-picker>
							</td>
						</tr>
						<tr>
							<td>unmatched colors:</td>
							<td v-for="color in colorsByRangeMatch.unmatchedColors">
								<color-picker
									v-bind:r = "color.r"
									v-bind:g = "color.g"
									v-bind:b = "color.b"
									readonly="true"
								></color-picker>
							</td>
						</tr>
						<tr>
							<td>matched colors:</td>
							<td v-for="color in colorsByRangeMatch.matchedColors">
								<color-picker
									v-bind:r = "color.r"
									v-bind:g = "color.g"
									v-bind:b = "color.b"
									readonly="true"
								></color-picker>
							</td>
						</tr>
					</table>
				</div>

				<div class="centertxt darkerbg">
					<p>
						click to edit color
						<br>ctrl-click to set as main color
					</p>
					<hr>
					<table id="colors">
						<tr class="shadeRow" v-for="(row, iRow) in rows">
							<td class="rowDeletButton" @click="deleteRow(iRow)"><div>üóëÔ∏è</div></td>
							<td class="shadeSlotName" contenteditable="true" @blur="changeRowName($event, row)">{{row.name}}</td>
							<td
								class="color"
								v-for="(colorSlot, colorSlotIndex) in row.colors"
								@click="clickOnColor($event, colorSlot, row)"
							>
								<color-picker
									v-bind:class = "{ main: colorSlot.main }"

									v-bind:r.sync = "colorSlot.r"
									v-bind:g.sync = "colorSlot.g"
									v-bind:b.sync = "colorSlot.b"
									readonly="false"

									@delete-color = "deleteColor(colorSlotIndex, row)"
								>
								</color-picker>
						</td>
							<td class="color"><div @click="addSlot(row)" name="add Color Slot">+</div></td>
						</tr>
						<tr v-if="rows.length < 8">
							<td colspan=100% style="padding-top: 2px;">
								<button style="width: 100%;" @click="addRow" name="add Shade Row">+</button>
							</td>
						</tr>
					</table>
				</div>

				<div class="darkerbg">
					<table id="colorProfiles">
						<tr v-for="(colorSlot, colorSlotIndex) in colorProfilesMainColors"
							class="colorSlot"
						>
							<td><input type="radio" :id=`$ColorSlot_${colorSlotIndex}` v-bind:value="colorSlotIndex" v-model="selectedColorProfile">
							<td><label :for=`$ColorSlot_${colorSlotIndex}`>{{colorSlotIndex}}</label></td>
							<td class="shadeSlotName" contenteditable="true" @blur="changeSlotName($event, colorSlot)">{{colorSlot.name || ""}}</td>
							<!--
								the vue style guide says to not do v-for with v-if because v-if has priority but this is what I need it to do...?
								don't use a color-picker for the 1st row
							-->
							<td v-if="colorSlotIndex == 0"
								v-for="shade in colorSlot.shades"
								v-bind:style="{backgroundColor: shade ? `rgb(${shade.rgb.r}, ${shade.rgb.g}, ${shade.rgb.b})` : 'black'}"
							>
							<td v-if="colorSlotIndex > 0"
								v-for="shade in colorSlot.shades"
								class="color"
							>
								<color-picker
									v-bind:r.sync = "shade.rgb.r"
									v-bind:g.sync = "shade.rgb.g"
									v-bind:b.sync = "shade.rgb.b"
									@updatepls = "calcShadesHSV(shade); $forceUpdate(); updateDisplays();"
								>
								</color-picker>
							</td>
							<td v-if="colorSlotIndex > 5" class="rowDeletButton" @click="deleteColorSlotRow(colorSlotIndex)"><div>üóëÔ∏è</div></td>
						</tr>
						<tr v-if="colorProfilesMainColors.length < 16">
							<td colspan=100% style="padding-top: 2px;">
								<button style="width: 100%;" @click="addColorProfileRow" name="add color profile row">+</button>
							</td>
						</tr>
					</table>
				</div>
			</div>

			<footer>
				<p style="clear:both;">Copy-paste your current colors.gml's file content in the text field on the right, or start defining colors.
				<br>The text field will be updated in real time (and forced into this tool's format because it's easier for me, sorry!)
				<br>Copy-paste it back into your colors.gml file once you're done.
				<br>You can load a sprite to preview recolors (The tool is completely local, nothing gets uploaded anywhere.)
				<br>You can rename rows and slots by clicking on their name. This will update the header comment in the .gml file.
				<br>
				<br>Color picker heavily based on https://vuejsexamples.com/vue-color-picker/ - "a cool Color Picker with vue.js BY Florian Schulz."
				</p>
				<input type="checkbox" id="calcFromFurthestHue" v-model="calcFromFurthestHue" @click="generateGmlCode"></input>
				<label for="calcFromFurthestHue">{{ calcFromFurthestHue ? 'calculating ranges from main to furthest Hue only' : 'calculating ranges from main to biggest individual H, S, V values' }}</label>
			</footer>
		</div>

		<script src="index.js"></script>
	</body>
</html>
